let WHATSAPP_CONFIG ={link: 'https: channel: 'https:};function createWhatsAppLink(productName){const message = `Halo admin, saya tertarik dengan produk ${productName}. Apakah masih tersedia?`;const encodedMessage = encodeURIComponent(message);if (WHATSAPP_CONFIG.link.includes('wa.me/')){const separator = WHATSAPP_CONFIG.link.includes('?') ? '&' : '?';return `${WHATSAPP_CONFIG.link}${separator}text=${encodedMessage}`;}return `https:}async function loadProducts(limit = null){try{const url = limit ? `api/get_products.php?limit=${limit}` : 'api/get_products.php';console.log('Loading products from:', url);const response = await fetch(url);if (!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const data = await response.json();console.log('Products API response:', data);if (data.success){console.log('Products loaded successfully:', data.products.length, 'items');console.log('Product details:', data.products);return data.products;}else{console.error('Error loading products:', data.message);return [];}}catch (error){console.error('Error fetching products:', error);return [];}}function displayProducts(products, containerId){console.log('displayProducts called with:', products.length, 'products for container:', containerId);const container = document.getElementById(containerId);if (!container){console.error('Container not found:', containerId);return;}console.log('Container found:', container);if (products.length === 0){console.log('No products to display');if (containerId === 'produk-container'){const loadingElement = document.getElementById('loading');const noProductsElement = document.getElementById('no-products');if (loadingElement) loadingElement.style.display = 'none';if (noProductsElement) noProductsElement.style.display = 'block';}return;}console.log('Clearing container and adding products...');container.innerHTML = '';products.forEach((product, index) =>{console.log('Creating card for product:', product.nama_produk);const productCard = createProductCard(product);container.appendChild(productCard);});console.log('Products added to container');if (containerId === 'produk-container'){const loadingElement = document.getElementById('loading');if (loadingElement) loadingElement.style.display = 'none';container.style.display = 'flex';}if (containerId === 'produk-unggulan'){container.style.display = 'flex';console.log('Homepage products container made visible');}}function handleViewMoreButton(totalProducts){const viewMoreContainer = document.getElementById('view-more-container');if (!viewMoreContainer){console.error('View more container not found');return;}if (totalProducts > 6){viewMoreContainer.style.display = 'block';const button = viewMoreContainer.querySelector('.btn');if (button){button.innerHTML = '<i class="fas fa-plus me-2"></i>Lihat Lainnya';}}else if (totalProducts > 0){viewMoreContainer.style.display = 'block';const button = viewMoreContainer.querySelector('.btn');if (button){button.innerHTML = 'Lihat Semua Produk <i class="fas fa-arrow-right ms-2"></i>';}}else{viewMoreContainer.style.display = 'none';}}function createProductCard(product){return createProductCardWithCategory(product);}function createProductCardWithCategory(product){const col = document.createElement('div');col.className = 'col-lg-4 col-md-6 mb-4';col.setAttribute('data-category', product.category_id || 'uncategorized');const whatsappLink = createWhatsAppLink(product.nama_produk);const shortDescription = product.deskripsi_singkat || 'Tidak ada deskripsi singkat';const fullDescription = product.deskripsi || 'Tidak ada deskripsi lengkap';const productId = `product-${product.id}`;const needsDetailButton = fullDescription.length > shortDescription.length + 20;console.log('Product detail button check:',{productId: productId, productName: product.nama_produk, shortLength: shortDescription.length, fullLength: fullDescription.length, needsDetailButton: needsDetailButton});let categoryBadge = '';if (product.nama_kategori){categoryBadge = ` <div class="position-absolute top-0 start-0 m-2"> <span class="badge bg-primary"> <i class="${product.category_icon || 'fas fa-tag'}me-1"></i> ${product.nama_kategori}</span> </div> `;}const createdDate = new Date(product.created_at).toLocaleDateString('id-ID',{day: 'numeric', month: 'short', year: 'numeric'});col.innerHTML = ` <div class="card product-card h-100 shadow-sm" onclick="window.location.href='detail-produk.html?id=${product.id}'" style="cursor: pointer;"> <div class="position-relative"> <img src="${product.foto}" class="card-img-top product-image" alt="${product.nama_produk}" loading="lazy"> ${categoryBadge}<div class="position-absolute bottom-0 end-0 m-2"> <small class="badge bg-dark bg-opacity-75"> <i class="fas fa-calendar me-1"></i>${createdDate}</small> </div> </div> <div class="card-body d-flex flex-column"> <h5 class="card-title fw-bold">${product.nama_produk}</h5> <div class="product-description flex-grow-1"> <div id="${productId}-short" class="description-short"> ${shortDescription}</div> ${needsDetailButton ? ` <div id="${productId}-full" class="description-full"> ${fullDescription}</div> <button class="btn btn-link p-0 mt-2 detail-toggle" onclick="event.stopPropagation();toggleDescription('${productId}')" id="${productId}-toggle"> <small>Lihat Detail <i class="fas fa-chevron-down ms-1"></i></small> </button> ` : ''}</div> <div class="mt-3"> <div class="row g-2"> <div class="col-8"> <a href="${whatsappLink}" target="_blank" class="btn btn-success w-100" onclick="event.stopPropagation()"> <i class="fab fa-whatsapp me-2"></i>Pesan Sekarang </a> </div> <div class="col-4"> <a href="detail-produk.html?id=${product.id}" class="btn btn-outline-primary w-100" title="Lihat Detail" onclick="event.stopPropagation()"> <i class="fas fa-eye"></i> </a> </div> </div> </div> </div> </div> `;setTimeout(() =>{const shortDiv = document.getElementById(`${productId}-short`);const fullDiv = document.getElementById(`${productId}-full`);if (shortDiv){shortDiv.innerHTML = shortDescription;}if (fullDiv){fullDiv.innerHTML = fullDescription;}}, 0);return col;}function showAddress(){const address = "Jl. Raya Pahlawan No.29, Cinangka, Kec. Sawangan, Kota Depok, Jawa Barat 16515, Indonesia";const encodedAddress = encodeURIComponent(address);const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let mapsUrl;if (isMobile){mapsUrl = `https:}else{mapsUrl = `https:}window.open(mapsUrl, '_blank');}document.addEventListener('DOMContentLoaded', function(){console.log('DOM loaded, initializing FP Store...');loadSettings().then(() =>{console.log('Settings loaded, now loading products...');const currentPage = window.location.pathname.split('/').pop();console.log('Current page:', currentPage);if (currentPage === 'index.php' || currentPage === 'index.html' || currentPage === ''){console.log('Loading products for homepage...');loadProducts().then(allProducts =>{console.log('All products loaded:', allProducts.length);const totalProducts = allProducts.length;const displayedProducts = allProducts.slice(0, 6);console.log('Displaying products:', displayedProducts.length);displayProducts(displayedProducts, 'produk-unggulan');handleViewMoreButton(totalProducts);}).catch(error =>{console.error('Error loading products for homepage:', error);});}else if (currentPage === 'produk.html'){console.log('Loading products for product page...');initializeCategoryFiltering();}}).catch(error =>{console.error('Error loading settings:', error);const currentPage = window.location.pathname.split('/').pop();if (currentPage === 'index.php' || currentPage === 'index.html' || currentPage === ''){loadProducts().then(allProducts =>{const totalProducts = allProducts.length;const displayedProducts = allProducts.slice(0, 6);displayProducts(displayedProducts, 'produk-unggulan');handleViewMoreButton(totalProducts);});}else if (currentPage === 'produk.html'){initializeCategoryFiltering();}});document.querySelectorAll('a[href^="#"]').forEach(anchor =>{anchor.addEventListener('click', function (e){e.preventDefault();const target = document.querySelector(this.getAttribute('href'));if (target){target.scrollIntoView({behavior: 'smooth', block: 'start'});}});});window.addEventListener('scroll', function(){const navbar = document.querySelector('.navbar');if (window.scrollY > 50){navbar.classList.add('shadow');}else{navbar.classList.remove('shadow');}});});async function loadSettings(){try{console.log('Loading settings from API...');const response = await fetch('api/get_settings.php');const data = await response.json();console.log('Settings API response:', data);if (data.success && data.settings){if (data.settings.whatsapp_link){WHATSAPP_CONFIG.link = data.settings.whatsapp_link;console.log('WhatsApp link updated:', WHATSAPP_CONFIG.link);}if (data.settings.whatsapp_channel){WHATSAPP_CONFIG.channel = data.settings.whatsapp_channel;console.log('WhatsApp channel updated:', WHATSAPP_CONFIG.channel);}if (data.settings.site_phone){const phoneElement = document.getElementById('phone-number');if (phoneElement){phoneElement.textContent = data.settings.site_phone;console.log('Phone number updated on page:', data.settings.site_phone);}else{console.log('Phone number element not found on this page');}}updateWhatsAppLinks();console.log('Settings loaded successfully:', data.settings);}else{console.error('Settings API failed:', data.message);}}catch (error){console.error('Error loading settings:', error);}}function updateWhatsAppLinks(){const generalWhatsAppLinks = document.querySelectorAll('a[href*="wa.me"]');generalWhatsAppLinks.forEach(link =>{const currentHref = link.getAttribute('href');if (currentHref.includes('wa.me/')){const urlParams = new URLSearchParams(currentHref.split('?')[1] || '');const message = urlParams.get('text') || '';const separator = WHATSAPP_CONFIG.link.includes('?') ? '&' : '?';const newHref = message ? `${WHATSAPP_CONFIG.link}${separator}text=${encodeURIComponent(message)}` : WHATSAPP_CONFIG.link;link.setAttribute('href', newHref);}});const channelLinks = document.querySelectorAll('a[href*="whatsapp.com/channel"]');channelLinks.forEach(link =>{link.setAttribute('href', WHATSAPP_CONFIG.channel);});}function formatDate(dateString){const options ={year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Jakarta'};return new Date(dateString).toLocaleDateString('id-ID', options);}function showNotification(message, type = 'info'){const notification = document.createElement('div');notification.className = `alert alert-${type}alert-dismissible fade show position-fixed`;notification.style.cssText = 'top: 100px;right: 20px;z-index: 9999;min-width: 300px;';notification.innerHTML = ` ${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button> `;document.body.appendChild(notification);setTimeout(() =>{if (notification.parentNode){notification.remove();}}, 5000);}function openEmail(){const email = 'fpstore@gmail.com';const subject = 'Pertanyaan tentang Produk FP Store';const body = `Halo FP Store, Saya ingin bertanya tentang produk Anda. Terima kasih.`;const encodedSubject = encodeURIComponent(subject);const encodedBody = encodeURIComponent(body);const mailtoUrl = `mailto:${email}?subject=${encodedSubject}&body=${encodedBody}`;window.location.href = mailtoUrl;}function forceCacheRefresh(){if (confirm('Refresh halaman untuk melihat update terbaru?')){window.location.reload(true);}}function checkForUpdates(){const timestamp = new Date().getTime();const testUrl = `api/get_products.php?cache_bust=${timestamp}`;fetch(testUrl) .then(response => response.json()) .then(data =>{console.log('Update check completed at:', new Date().toLocaleTimeString());}) .catch(error =>{console.log('Update check failed:', error);});}if (window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1')){setInterval(checkForUpdates, 300000);}window.createWhatsAppLink = createWhatsAppLink;window.showAddress = showAddress;window.openEmail = openEmail;window.loadSettings = loadSettings;window.toggleDescription = toggleDescription;window.forceCacheRefresh = forceCacheRefresh;function toggleDescription(productId){console.log('toggleDescription called for:', productId);const shortDiv = document.getElementById(`${productId}-short`);const fullDiv = document.getElementById(`${productId}-full`);const toggleBtn = document.getElementById(`${productId}-toggle`);console.log('Elements found:',{shortDiv: !!shortDiv, fullDiv: !!fullDiv, toggleBtn: !!toggleBtn});if (shortDiv && fullDiv && toggleBtn){const isFullHidden = !fullDiv.classList.contains('show');console.log('Current state - full description hidden:', isFullHidden);if (isFullHidden){shortDiv.style.display = 'none';fullDiv.classList.add('show');toggleBtn.innerHTML = '<small>Lihat Ringkasan <i class="fas fa-chevron-up ms-1"></i></small>';console.log('Switched to full description');}else{fullDiv.classList.remove('show');shortDiv.style.display = 'block';toggleBtn.innerHTML = '<small>Lihat Detail <i class="fas fa-chevron-down ms-1"></i></small>';console.log('Switched to short description');}}else{console.error('Toggle elements not found for product:', productId);console.error('Missing elements:',{shortDiv: !shortDiv ? 'missing' : 'found', fullDiv: !fullDiv ? 'missing' : 'found', toggleBtn: !toggleBtn ? 'missing' : 'found'});}}window.toggleDescription = toggleDescription;document.addEventListener('keydown', function(e){if (e.ctrlKey && e.shiftKey && e.key === 'A'){e.preventDefault();window.open('admin/login.php', '_blank');}});function initDarkMode(){const savedTheme = localStorage.getItem('theme') || 'light';document.documentElement.setAttribute('data-theme', savedTheme);updateToggleIcons(savedTheme);document.addEventListener('click', function(e){if (e.target.closest('.theme-toggle')){e.preventDefault();toggleDarkMode();}});}function toggleDarkMode(){const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';const newTheme = currentTheme === 'light' ? 'dark' : 'light';document.documentElement.setAttribute('data-theme', newTheme);localStorage.setItem('theme', newTheme);updateToggleIcons(newTheme);const toggleBtn = document.querySelector('.theme-toggle');if (toggleBtn){toggleBtn.style.transform = 'scale(0.95)';setTimeout(() =>{toggleBtn.style.transform = 'scale(1)';}, 100);}console.log('Theme switched to:', newTheme);}function updateToggleIcons(theme){const toggleButtons = document.querySelectorAll('.theme-toggle i');toggleButtons.forEach(icon =>{icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';});}document.addEventListener('DOMContentLoaded', initDarkMode);if (document.readyState === 'loading'){document.addEventListener('DOMContentLoaded', initDarkMode);}else{initDarkMode();}let allProducts = [];let allCategories = [];let filteredProducts = [];let currentCategory = 'all';let currentSort = 'newest';async function loadCategories(){try{console.log('Loading categories...');const response = await fetch('api/get_categories.php');if (!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const data = await response.json();console.log('Categories API response:', data);if (data.success){console.log('Categories loaded successfully:', data.categories.length, 'items');allCategories = data.categories;return data.categories;}else{console.error('Error loading categories:', data.message);return [];}}catch (error){console.error('Error fetching categories:', error);return [];}}function displayCategoryFilter(categories){const filterContainer = document.getElementById('category-filter');if (!filterContainer){console.log('Category filter container not found');return;}const allButton = filterContainer.querySelector('[data-category="all"]');filterContainer.innerHTML = '';filterContainer.appendChild(allButton);categories.forEach(category =>{const button = document.createElement('button');button.className = 'btn btn-outline-primary';button.setAttribute('data-category', category.id);button.innerHTML = `<i class="${category.icon}me-2"></i>${category.nama_kategori}<span class="badge bg-secondary ms-1">${category.product_count}</span>`;button.addEventListener('click', () => filterProductsByCategory(category.id));filterContainer.appendChild(button);});allButton.addEventListener('click', () => filterProductsByCategory('all'));}function filterProductsByCategory(categoryId){console.log('Filtering products by category:', categoryId);console.log('All products:', allProducts.length);console.log('Sample product category_id:', allProducts[0]?.category_id);currentCategory = categoryId;const filterButtons = document.querySelectorAll('#category-filter button');filterButtons.forEach(btn => btn.classList.remove('active'));const activeButton = document.querySelector(`[data-category="${categoryId}"]`);if (activeButton){activeButton.classList.add('active');}if (categoryId === 'all'){filteredProducts = [...allProducts];console.log('Showing all products:', filteredProducts.length);}else{filteredProducts = allProducts.filter(product =>{const matches = product.category_id && product.category_id == categoryId;console.log(`Product "${product.nama_produk}" (category_id: ${product.category_id}) matches category ${categoryId}:`, matches);return matches;});console.log('Filtered products for category', categoryId, ':', filteredProducts.length);}sortProducts(currentSort);updateProductCount();updateClearFiltersButton();console.log('Final filtered products:', filteredProducts.length);displayProducts(filteredProducts, 'produk-container');}function sortProducts(sortType){console.log('Sorting products by:', sortType);currentSort = sortType;switch (sortType){case 'newest': filteredProducts.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));break;case 'oldest': filteredProducts.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));break;case 'name-asc': filteredProducts.sort((a, b) => a.nama_produk.localeCompare(b.nama_produk));break;case 'name-desc': filteredProducts.sort((a, b) => b.nama_produk.localeCompare(a.nama_produk));break;default: console.warn('Unknown sort type:', sortType);}displayProducts(filteredProducts, 'produk-container');}function updateProductCount(){const countElement = document.getElementById('product-count');if (!countElement) return;const totalProducts = allProducts.length;const displayedProducts = filteredProducts.length;let countText = '';if (currentCategory === 'all'){countText = `<i class="fas fa-box me-2"></i>Menampilkan ${displayedProducts}produk`;}else{const categoryName = allCategories.find(cat => cat.id == currentCategory)?.nama_kategori || 'Kategori';countText = `<i class="fas fa-box me-2"></i>Menampilkan ${displayedProducts}produk dari kategori "${categoryName}"`;}countElement.innerHTML = countText;}function updateClearFiltersButton(){const clearButton = document.getElementById('clear-filters');if (!clearButton) return;if (currentCategory !== 'all' || currentSort !== 'newest'){clearButton.style.display = 'inline-block';}else{clearButton.style.display = 'none';}}function resetAllFilters(){console.log('Resetting all filters...');currentCategory = 'all';currentSort = 'newest';document.getElementById('sort-select').value = 'newest';filterProductsByCategory('all');}async function initializeCategoryFiltering(){if (window.location.pathname.includes('produk.html')){console.log('Initializing category filtering and sorting...');const [categories, products] = await Promise.all([ loadCategories(), loadProducts() ]);console.log('Loaded data:',{categories: categories.length, products: products.length, sampleProduct: products[0]});allProducts = products;filteredProducts = [...products];displayCategoryFilter(categories);const sortSelect = document.getElementById('sort-select');if (sortSelect){sortSelect.addEventListener('change', (e) =>{sortProducts(e.target.value);});}const clearButton = document.getElementById('clear-filters');if (clearButton){clearButton.addEventListener('click', resetAllFilters);}sortProducts('newest');updateProductCount();updateClearFiltersButton();console.log('Category filtering initialized successfully');}}